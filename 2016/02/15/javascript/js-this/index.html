<!DOCTYPE html><html class="no-js"><head><meta charset="utf-8"><title>司马－Simmer - Simmer</title><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/style.css"><!-- detech broser's env --><script src="/js/modernizr.js" type="text/javascript"></script><meta name="description" content="A Blog Powered By Hexo"></head><body><div class="nav nav-show clearfix"><div title="隐藏导航" id="nav-btn" class="nav-guide"><i class="icon nav-icon">&#xe603;</i></div><div class="nav-inner clearfix"><a href="/" class="nav-item"><div class="nav-item-inner"><div class="icon">&#xe606;</div><span>Home</span></div></a><a href="/archives" class="nav-item"><div class="nav-item-inner"><div class="icon">&#xe602;</div><span>Archives</span></div></a><a href="/categories" class="nav-item"><div class="nav-item-inner"><div class="icon">&#xe604;</div><span>Categorys</span></div></a><a href="/tags" class="nav-item"><div class="nav-item-inner"><div class="icon">&#xe601;</div><span>Tags</span></div></a><a href="/about" class="nav-item"><div class="nav-item-inner"><div class="icon">&#xe605;</div><span>About</span></div></a></div></div><div class="wraper"><div class="main"><section class="content"><div class="post"><article class="post-block"><h2 class="post-title"><a href="/2016/02/15/javascript/js-this/" class="post-title-link">细数那些年我们使用过的this</a></h2><div class="post-subtitle clearfix"><span class="post-date">2016年2月15日</span></div><div class="post-content"><h2 id="This介绍"><a href="#This介绍" class="headerlink" title="This介绍"></a>This介绍</h2><p>关于Javascript中的this,相信接触过的人都不会感到陌生。可以说javascript之所以如此的’强大’,<code>this</code>可以说是功不可没。它有以下几个特点：</p>
<ul>
<li>随着javascript函数的不同调用方式，<code>this</code>的取值可能会不同（this在global下指向的是<code>window</code>）</li>
<li>在函数的标识符解析的过程中，<code>this</code>的解析仅仅只限于当前函数作用域，而不会通过作用域链向上查找。</li>
<li><code>this</code>与<code>Function.prototype.call/apply</code>和<code>Function.prototype.bind</code>的相结合，使得有趣的事情发生。(<code>this</code>的指向变成我们所指定的)<a id="more"></a>
</li>
</ul>
<p>关于this的常见用法相信你已经看了不少了，我google了一些还算不错的:</p>
<ul>
<li><a href="http://www.ruanyifeng.com/blog/2010/04/using_this_keyword_in_javascript.html" target="_blank" rel="external">Javascript的this用法- 阮一峰</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/this" target="_blank" rel="external">this-MDN</a></li>
<li><a href="http://mao.li/javascript/javascript-this/" target="_blank" rel="external">javascript 中的this关键字总结</a></li>
</ul>
<p>接下来的内容希望你能先看完上面的资料，至少有一个大概的印象，这样才能愉快的查看下面的栗子～～</p>
<h2 id="举个栗子"><a href="#举个栗子" class="headerlink" title="举个栗子"></a>举个栗子</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">window</span>.name = <span class="string">'global'</span>;</div><div class="line">jQuery.name = <span class="string">'jQuery'</span>;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">jQuery</span>(<span class="params">selector, context</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span>  <span class="keyword">new</span> jQuery.prototype.init();</div><div class="line">&#125;;</div><div class="line">jQuery.prototype = &#123;</div><div class="line">    init: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.name = <span class="string">'new obj'</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">    &#125;,</div><div class="line">    getName: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</div><div class="line">    &#125;,</div><div class="line">    name: <span class="string">'jQuery.prototype'</span></div><div class="line">&#125;;</div><div class="line">jQuery.prototype.init.prototype = jQuery.prototype; </div><div class="line"><span class="keyword">var</span> objA = jQuery();</div><div class="line"><span class="keyword">var</span> getName = objA.__proto__.getName; </div><div class="line"><span class="keyword">var</span> objB = &#123;name:<span class="string">'simmer'</span>&#125;;</div><div class="line">objB.somemethod = getName;</div><div class="line"><span class="keyword">var</span> objC = <span class="keyword">new</span> getName();</div><div class="line"><span class="built_in">console</span>.dir(objA.getName());  <span class="comment">// 1</span></div><div class="line"><span class="built_in">console</span>.dir(getName());  <span class="comment">// 2</span></div><div class="line"><span class="built_in">console</span>.dir(objA.__proto__.getName()); <span class="comment">// 3</span></div><div class="line"><span class="built_in">console</span>.dir(objB.somemethod()); <span class="comment">// 4</span></div><div class="line"><span class="built_in">console</span>.dir(objC); <span class="comment">// 5</span></div></pre></td></tr></table></figure>
<p>不要问我为什么是<code>jQuery</code>,最近刚好在看jQuery源码，就酱＝＝<br>接下来根据你的判断分别写下1，2，3，4，5处console出的值。</p>
<p>＋<br>＋<br>＋<br>＋<br>＋<br>＋<br>防作弊线－－－－－－－－－－－－－－－<br>＋<br>＋<br>＋<br>＋<br>＋<br>＋<br>＋<br>让我们看下结果(为了方便查看我吧代码全部截取下来并加上一些注解)：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">window</span>.name = <span class="string">'global'</span>;</div><div class="line">jQuery.name = <span class="string">'jQuery'</span>;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">jQuery</span>(<span class="params">selector, context</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span>  <span class="keyword">new</span> jQuery.prototype.init();</div><div class="line">&#125;;</div><div class="line">jQuery.prototype = &#123;</div><div class="line">    init: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.name = <span class="string">'new obj'</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">    &#125;,</div><div class="line">    getName: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</div><div class="line">    &#125;,</div><div class="line">    name: <span class="string">'jQuery.prototype'</span></div><div class="line">&#125;;</div><div class="line">jQuery.prototype.init.prototype = jQuery.prototype; </div><div class="line"><span class="comment">// 类似将jQuery的原型覆盖jQuery原型上init方法的原型</span></div><div class="line"><span class="keyword">var</span> objA = jQuery(); <span class="comment">// 实例化一个对象A</span></div><div class="line"><span class="keyword">var</span> getName = objA.__proto__.getName; </div><div class="line"><span class="comment">// 引用实例对象A的__proto__属性(其实这是一个指针，指向的是一个构造器的原型对象)</span></div><div class="line"><span class="keyword">var</span> objB = &#123;name:<span class="string">'simmer'</span>&#125;; <span class="comment">// 新建一个对象B</span></div><div class="line">objB.somemethod = getName; <span class="comment">// 给B添加一个方法 这个方法是jQuery原型上的方法</span></div><div class="line"><span class="keyword">var</span> objC = <span class="keyword">new</span> getName();</div><div class="line"><span class="built_in">console</span>.dir(objA.getName());  <span class="comment">// 'new obj'</span></div><div class="line"><span class="built_in">console</span>.dir(getName());  <span class="comment">// 'global'</span></div><div class="line"><span class="built_in">console</span>.dir(objA.__proto__.getName()); <span class="comment">// 'jQuery.prototype'</span></div><div class="line"><span class="built_in">console</span>.dir(objB.somemethod()); <span class="comment">// 'simmer'</span></div><div class="line"><span class="built_in">console</span>.dir(objC); <span class="comment">// chrome返回'jQuery.getName' Firefox返回'[object Object]'</span></div></pre></td></tr></table></figure>
<p>是不是和你分析的一样呢？我们一个个来分析下吧。</p>
<h3 id="console-1"><a href="#console-1" class="headerlink" title="console 1"></a>console 1</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.dir(objA.getName()); <span class="comment">// 'new obj'</span></div></pre></td></tr></table></figure>
<p>这里的<code>objA</code>是jQuery的一个实例，<code>getName</code>是jQuery原型上的方法，所以此处的<code>getName</code>方法是在实例上面通过<code>__pro__</code>属性查找并调用在<code>jQuery.prototype</code>上的<code>getName</code>方法。<br>所以我们可以知道通过原型链的查找并调用执行的<code>function</code>中的<code>this</code>指向的就是这个调用方法的实例。<code>this === objA</code></p>
<h3 id="console-2"><a href="#console-2" class="headerlink" title="console 2"></a>console 2</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.dir(getName());  <span class="comment">// 'global'</span></div></pre></td></tr></table></figure>
<p>这里的<code>getName</code>是我们通过chrome和firefox私有属性<code>__proto__</code>（它指向的是实例的构造器的原型）获取到的<code>jQuery.prototype</code>上的方法。但是在这里<code>getName</code>中保存的是指向<code>jQuery.prototype.getName</code>的指针，他是在全局环境下运行的所以这里毫无疑问<code>this === window</code>也就是说<code>this.name === window.name</code></p>
<h3 id="console-3"><a href="#console-3" class="headerlink" title="console 3"></a>console 3</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.dir(objA.__proto__ .getName()); <span class="comment">// 'jQuery.prototype'</span></div></pre></td></tr></table></figure>
<p>这里很明显也是通过访问实例的私有属性<code>__proto__</code>进而执行<code>jQuery.prototype.getName</code>,因为这里的执行环境是相当于调用<code>jQuery.prototype</code>对象上面的方法，故而<code>this === jQuery.prototype</code></p>
<h3 id="console-4"><a href="#console-4" class="headerlink" title="console 4"></a>console 4</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.dir(objB.somemethod()); <span class="comment">// 'simmer'</span></div></pre></td></tr></table></figure>
<p>我们知道<code>getName</code>变量保存着指向<code>jQuery.prototype.getName</code>方法的引用，又由于在javascript中对象的赋值时按照引用来赋值的，所以这里呢<code>objB.somemethod = getName;</code>中objB的<code>somemethod</code>方法也保存指向<code>jQuery.prototype.getName</code>方法的引用，所以当通过<code>objB.somemethod()</code>这种形式调用<code>jQuery.prototype.getName</code>方法时，这个方法是作为对象的方法调用的，故而有<code>this === objB</code></p>
<h3 id="console-5"><a href="#console-5" class="headerlink" title="console 5"></a>console 5</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.dir(objC); <span class="comment">// chrome返回'jQuery.getName' Firefox返回'[object Object]'</span></div></pre></td></tr></table></figure>
<p>最后一种情况也比较简单，我们知道函数的调用分为2种情况，一种是作为普通函数进行调用，另外一种就是通过使用<code>new</code>操作符的形式进行调用。熟悉javascript的童鞋应该知道javascript的类正是通过这种new的形式创建的。简单来说就是通过<code>new</code>来调用函数，在函数内部会自动新建一个对象，而在这个函数内部使用的<code>this</code>则会自动指向这个新建的对像，最后在自动返回这个新建对象(在没有return的情况下)。类似于：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> obj = &#123;&#125;; <span class="comment">// 新建对象</span></div><div class="line"><span class="keyword">constructor</span>.apply(obj);  // 更正this 指向新的对象</div></pre></td></tr></table></figure></p>
<p>但是这里提前返回了<code>this.name</code> ，他是一个字符串，并不是对象，我通过<code>typeof objC</code>得到<code>object</code>，所以javascript解析器会默认返回一个空的对象。，在chrome中返回的<code>jQuery.getName</code>可能是默认返回构造器的引用组成的名字，相比指向firefox就靠谱多了，直接返回<code>&#39;[object Object]&#39;</code> 表示这是一个对象</p>
<h2 id="小总结"><a href="#小总结" class="headerlink" title="小总结"></a>小总结</h2><ul>
<li>JavaScript中的<code>this</code>可以有不同的取值，这是根据某个函数的具体调用情况来看的。</li>
<li>我们知道当javascript在某个函数内部没有查找到需要的变量时候，会沿着作用域链向外层作用域环境中(全局环境是window)中查找变量。而神奇的<code>this</code>则不再这个变量查找机制范围内，每个函数内的<code>this</code>取值是要到函数运行时候才能确定的，这也是为什么javascript有着如此迷人的魅力原因所在。</li>
<li>要想知道<code>this</code>的取值,关注函数具体的调用方式，全局调用？对象方法调用？使用<code>new</code>操作符构造实例调用？实例公有方法调用(<code>__proto__</code>)?还是通过<code>Function.prototype.call/apply</code>自定义<code>this</code>调用？亦或者是通过<code>Function.prototype.bind</code>(ES5)调用？(注意：每个函数只能bind一次，且以第一次bind为准)</li>
</ul>
<p>(完)</p>
<p>由于水平有限，如有错误，欢迎在下方进行评论指出。</p>
</div></article></div><div class="paginator clearfix"><a href="/2016/03/06/javascript/bind/" class="prev">上一篇</a><a href="/2015/12/24/other/hexo-theme/" class="next">下一篇</a></div><div data-thread-key="/2016/02/15/javascript/js-this/" data-title="细数那些年我们使用过的this" data-url="2016/02/15/javascript/js-this/" class="ds-thread"><script type="text/javascript">var duoshuoQuery = {short_name: "simmer"};
(function() {
    var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
//- 多说公共JS代码                   </script></div></section><section class="footer"><p><a href="/about/index.html">Simmer</a> | Make it easy.
</p><div id="go-pg-top" style="display: none; opacity: 0.6;" title="返回顶部">TOP</div></section></div></div><script src="/js/jquery-1.11.1.js"></script><script src="/js/common.js"></script><script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1257488449' class='cnzz'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s4.cnzz.com/z_stat.php%3Fid%3D1257488449%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script></body></html>